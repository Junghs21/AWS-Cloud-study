# Chap05. AWS 스토리지 서비스
## 5.1 스토리지 개요

- 스토리지
    - 데이터를 보관하는 장소
    - 우리가 사용하는 모든 저장 장치

> USB(Universal Serial Bus): 이동성 및 휴대성을 고려해서 간단한 데이터를 보관할 때 사용  
외장 하드(SSD, HDD): 대용량의 데이터를 보관하거나 백업할 때 사용

## 5.2 스토리지 서비스 및 주요 기능

### AWS에서 제공하는 스토리지 서비스 종류들
**블록 스토리지**
- 단일 스토리지 볼륨(volume)을 ‘블록’이라는 개별 단위로 분할해서 저장
- 각 블록은 저장된 위치에 고유한 주소가 있기 때문에 서버에서 파일을 요청하면 블록들을 재구성하여 하나의 데이터로 서버에 전달
- 클라우드 환경에서 블록 스토리지의 각 블록은 가상 머신 인스턴스에 위치
- 블록 스토리지는 SAN(Storage Area Network) 또는 가상 머신의 디스크로 사용

> 💡 **SAN(Storage Area Network)**  
서로 다른 종류의 데이터 저장 장치를 한 데이터 서버에 연결하여 총괄적으로 관리해 주는 네트워크

**파일 스토리지**

- 파일 수준 또는 파일 기반 스토리지라고 하며, 디렉터리(directory) 구조로 파일을 저장
- 각 파일은 폴더에 종속되고 폴더 역시 다른 폴더에 종속되어 계층 구조를 가짐
- 개인용 컴퓨터와 서버에서 일상적인 작업을 공유하며 사용할 수 있는 장점
- 파일이 늘어나면 분류하거나 정리(file system indexing)하는데 시간이 더 소요된다는 단점
- 파일 스토리지는 NAS(Network Attached Storage)에 사용

> 💡 **NAS(Network Attached Storage)**  
컴퓨터 네트워크에 연결된 파일 수준의 컴퓨터 기억 장치로, 서로 다른 네트워크 클라이언트에 데이터 접근 권한을 제공


**객체 스토리지**

- 각 데이터 조각을 가져와서 객체로 지정하고, 개별 단위로 저장
- 모든 객체는 중첩된 계층 구조 없이 단일한 평면적인 주소 공간에 저장
    - 이 평면 주소 공간에는 데이터 및 관련 메타데이터로 구성된 객체에 고유 식별자가 존재
- OS나 파일 시스템에 의존하지 않으면서 데이터를 저장하고 객체에 쉽게 접근 가능
- 시스템에서는 객체의 키(이름)만 알고 있으면 쉽고 빠르게 대상을 검색 가능
- 객체 스토리지 접근에는 HTTP 프로토콜 기반의 REST(REpresentational State Transfer) API(Application Programming Interface)를 사용
- 저장할 수 있는 데이터의 수와 파일 크기에 제한 없다.
- 데이터 저장의 총 영량 역시 무제한에 가깝다.

![aws 스토리지 종류 및 특징][image1]

[image1]: https://velog.velcdn.com/images/kandy1002/post/f7aa67d8-42a7-4a8a-93c6-ac4633089613/image.png


### 스토리지 선택 기준
-  데이터 손실 가능성
- 서비스 지속 시간
- 저장 및 전송 중 데이터 보안
- 스토리지 단위 가격
- 스토리지 크기 및 사용자 수 변경
- 다른 서비스와 호환성

클라우드 스토리지는 어디에서나 접근할 수 있는 편의성, 대량의 데이터를 수용할 수 있는 확장성을 갖추고 있다.


## 5.3 Amazon EBS

### EBS란

- Amazon EBS(Elastic Block Store)
    - 인스턴스에 사용할 수 있는 블록 스토리지 볼륨을 제공하는 서비스
    - 블록 스토리지 특성을 이용한 저장 방식

EBS 스토리지는 AWS 관리 콘솔에서 필요한 용량과 성능에 맞추어서 볼륨을 생성한 후 EC2 인스턴스에 연결하고 파일 시스템 등을 포맷한 후 사용

포맷이 완료되면 해당 볼륨을 서버에서 마운트한 후 데이터를 해당 디렉터리에 저장해서 사용

**시스템 포맷은 운영 체제에 따라 다르게 사용**

> 리눅스는 xfs 또는 ext4 유형이 주로 사용  
윈도우는 NTFS 포맷이 주로 사용

EBS는 고속 네트워크로 연결되어 있으며, 데이터 수명 시간이 독립되어 있다.

- **독립된 데이터 수명 시간?**
    - ‘서로 연결된 인스턴스와 볼륨을 사용하다 해당 인스턴스를 삭제해도 볼륨은 계속 사용할 수 있고 그 볼륨에 저장된 데이터도 다른 인스턴스와 연결하여 이어서 사용할 수 있다’는 의미

결론적으로 인스턴스와 EBS 볼륨은 서로 종속 관계에 있지 않으며, 인스턴스는 다수의 볼륨을 연결하여 사용 가능

하지만 하나의 EBS 볼륨은 한 번에 하나의 인스턴스에만 연결할 수 있고, 해당 인스턴스에서 지원하는 형태의 시스템으로 포맷해야만 사용 가능

![Amazon EBS 스토리지 예시][image2]

[image2]: https://lh4.googleusercontent.com/Ys5AkJQAlESey3YKRaXMD5JlpgrY8EgbqKQQf4zNqZkB9-zG0HweKOtB-K_UmNSA_zcTYg4nigU4DXgCKmGaUPdhx_mYUuG4KDXS_nudolz4rc-b66Gnec9iXKAtLPrEAPYTvbQ

### EBS 특징

- 데이터 가용성
    - 단일 하드웨어 구성 요소의 장애 때문에 데이터가 손실되지 않도록 해당 가용 영역 내에서 자동으로 데이터를 복제
- 데이터 지속성
    - EBS 볼륨은 인스턴스 수명과 관계없이 유지되는 비관계형 인스턴스 스토리지
- 데이터 안전성
    - Amazon EBS 암호화 기능으로 암호화된 EBS 볼륨을 생성 가능
    - 암호화 표준 알고리즘(AES-256)을 사용
- 데이터 백업
    - 모든 EBS 볼륨의 스냅샷(백업)을 생성하고, 다중 가용 영역에 중복 저장이 가능한 Amazon S3(Simple Storage Service)에 볼륨 내 데이터 사본을 백업 가능
- 데이터 확장성
    - 서비스를 중단할 필요 없이 볼륨 유형, 볼륨 크기, IOPS(Input/Output operations Per Second)용량을 수정 가능


### EBS 볼륨 유형

EBS 볼륨에는 크게 SSD와 HDD 유형이 있다.
- SSD
    - 메모리형 디스크를 사용
    - 데이터를 빠르게 읽고 처리하는 장점
    - 주로 서버의 운영 체제가 설치되는 OS 영역이나 일반 데이터베이스 보관용 스토리지 유형으로 사용
- HDD
    - 플래터(platter) 디스크를 사용
    - 속도와 상관없이 데이터 저장 용량이 많이 필요할 때 사용


### EBS 스냅샷

특정 시점에 포인트를 찍어서 그 시점으로 되돌아갈 수 있는 지점을 만드는 기능

- 증분식 백업 방식을 이용하여 마지막 스냅샷 이후 변경되는 데이터 블록만 기록하고 복제하므로 저장 비용과 시간도 효과적으로 절감
- 매번 원본과 크기가 같지 않아도 변경된 부분만 증분되어 백업되기 때문에 특정 데이터를 삭제해도 어느 한 부분의 스냅샷만 가지고 있다면 복구 가능
    - 스냅샷을 삭제할 때 다른 스냅샷에서 참조되지 않는 영역만 데이터에서 제거되기 때문이다.

스냅샷은 기본적으로 Amazon S3라는 스토리지 공간에 저장되어 여러 가용 영역에 자동으로 복제  
다른 계정으로 공유할 수 있고 스냅샷을 이용하여 다른 리전으로 복제 가능



### EFS란

- Amazon EFS(Elastic File System)
    - 클라우드 환경과 온프레미스 환경에서 사용할 수 있는 완전 관리형 네트워크 파일 시스템
        - 완전 관리형이란 ‘클라우드에서 하드웨어 프로비저닝 유지 관리, 소프트웨어 구성, 모니터링, 복잡한 성능 조절 등 모든 것을 관리하기 때문에 사용자 입장에서는 별다른 관리가 필요 없다’는 의미

처음 파일 시스템을 생성한 후 서버에 연결하면 사용한 만큼 자동으로 스토리지 크기가 확장

사용한 만큼만 비용을 지불하면 되기 때문에 사실상 용량 제한 없이 사용 가능

![Amazon EFS 스토리지][image3]

[image3]: https://docs.aws.amazon.com/ko_kr/efs/latest/ug/images/efs-ec2-how-it-works-Regional_china-world.png

### EFS 특징

EFS는 고성능 네트워크 파일 시스템으로, 여러 대의 컴퓨터가 네트워크상의 동일한 데이터에 접근해야 할 때 사용

- NFS 표준 프로토콜 기반의 연결을 지원하고 있어 기존 다양한 애플리케이션과 유연하게 통합 가능
- 여러 컴퓨팅 인스턴스에서 동시에 사용 가능
- 기존 NAS처럼 사용자 홈 디렉터리를 공유하여 애플리케이션을 개발 가능


> 💡 **NFS(Network File System)**  
네트워크 기반의 파일 시스템으로, 공유된 원격의 호스트 파일을 다른 시스템이 로컬에서 가용할 수 있도록 구현한 방식


**EFS 볼륨**

- IOPS가 높고 용량이 매우 크기 때문에 처리량이 많고 대기 시간이 짧다.
- 파일 시스템의 사용 증가에 따라 자동으로 용량 및 성능이 조정되는 탄력성을 제공
    - 네트워크 스토리지의 용량 및 성능 부족을 걱정할 필요가 없다.

EFS는 EBS처럼 가용 영역 단위의 서비스가 아니라 가용 영역 전반에 걸쳐 사용할 수 있는 스토리지이므로, 가용 영역 장애를 고려한 디자인이 가능해서 전통적인 NAS보다 뛰어난 가용성을 가진다.


## 5.4 Amazon S3

### S3 소개

- Amazon S3(Simple Storage Service)
    - AWS 서비스 중에서 EC2 서비스와 더불어 가장 오래되고, 기본이 되는 객체 스토리지 서비스
    - S3에 저장되는 데이터를 **객체**
    - 이 객체 저장소를 **버킷(bucket)**
    - 객체에 대한 입출력은 HTTP 프로토콜을 사용
    - REST API를 이용하여 명령을 전달

**특징**

- 99.9999%의 높은 내구성으로 디자인되어 있어 데이터 손실을 최소화
- 데이터 저장 공간이 무제한에 가까워 특별한 용량 제한 없이 데이터를 저장 가능
- 필요한 경우 다양한 스토리지 계층으로 데이터를 분류하여 데이터 저장 비용을 절감
- S3의 객체는 기본적으로 웹 접속이 가능
    - 간단한 정적 웹 콘텐츠를 S3에 올려 웹 서버의 도움 없이 바로 웹 서비스가 가능
- 보안 규정 준수 및 감시 기능을 제공
    - 데이터가 안전하게 저장되고 인증된 사용자만 접근
    - 필요한 경우 접근 권한 정책을 이용하여 해당 객체의 접근을 제어

![Amazon S3 스토리지][image4]

[image4]: https://img1.daumcdn.net/thumb/R800x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FmQheR%2Fbtq17ZlVqXH%2Fs4DQ2LkbIqK6l6O0FvLC00%2Fimg.png


### S3 구성 요소

Amazon S3는 데이터를 버킷 내 객체로 저장하는 객체 스토리지

- 버킷
    - 데이터 스토리지를 위한 S3의 기본 컨테이너
    - 객체는 반드시 버킷에 저장되어야 하며, 하나의 리전에서 생성된 후에는 버킷 이름과 리전을 변경할 수 없다.
- 객체
    - S3에 저장되는 기본 매체
    - 객체 데이터와 객체 메타데이터로 구성
        - 메타데이터는 객체를 설명하는 **이름 - 값**에 대한 하나의 쌍으로 존재
    - 객체를 저장할 때 사용자 정의 메타데이터를 지정 가능
    - 객체는 키(이름) 및 버전 ID를 이용하여 버킷 내에서 고유하게 식별
- 키
    - 버킷 내에서 객체의 고유한 식별자
    - 버킷 내 모든 객체는 고유한 하나의 키를 가짐
    - S3는 ‘버킷 + 키 + 버전’과 객체 사이의 기본 데이터 맵으로 생각할 수 있다.
- S3 데이터 일관성
    - S3 버킷에 있는 객체에 대해 여러 서버로 데이터를 복제하여 고가용성 및 내구성을 구현하고 데이터 일관성 모델을 제공

    > http://{버킷}.s3.amazonaws.com/{객체키}  
    **객체 키는 버킷 내 객체의 고유한 식별자**



### S3 특징
Amazon S3는 객체에 대해 빠르고 내구성과 가용성이 높은 키 기반의 접근성을 제공하여 데이터의 저장 및 검색에 특화된 객체 스토리지

![Amazon S3 버킷 데이터][image5]

[image5]: https://blog.kakaocdn.net/dn/dnkDUT/btshBltXNsH/VspKmqk1Fbg7gYdS2aLTc1/img.png

- S3는 하나의 리전 내 최소 3개 이상의 물리적으로 분리된 가용 영역에 데이터를 복제해서 저장하므로 높은 내구성과 고가용성을 제공
- 서버의 OS 도움 없이 객체별 접근이 가능하므로 데이터 저장 및 활용에 용이

또한 Amazon S3는 동일 버킷 내 여러 개의 객체 변형을 보유하여 데이터 복구에 특화된 객체 스토리지

- S3에 버전 관리 기능을 이용하여 버킷에 저장된 모든 버전의 객체를 보존하거나 검색 및 복원 가능
- 의도하지 않은 사용자 작업 및 애플리케이션 장애에서 쉽게 복구 가능

S3는 AWS와 다른 서비스를 유기적으로 연동시켜 다양한 형태로도 사용 가능



### S3 스토리지 클래스

S3는 여러 사용 사례에 맞게 설계된 **다양한 스토리지 클래스를 제공**

- **S3 standard**
    - 자주 접근하는 데이터를 저장하는 스토리지 유형
- **S3 intelligent-tiering**
    - 알 수 없거나 변화하는 접근 패턴이 있는 데이터를 저장하는 스토리지 유형
- **S3 standard-IA 및 S3 one zone-IA**
    - 데이터 수명은 길지만 자주 접근하지 않는 데이터를 저장하는 스토리지 유형
- **S3 glacier**
    - 데이터 수명이 제한되어 추후 삭제 예정인 데이터 및 백업을 위한 스토리지 유형

![Amazon S3 수명 주기 정책에 따른 스토리지 변화][image6]

[image6]: https://media.licdn.com/dms/image/D5612AQE2O8b2yc-GPQ/article-cover_image-shrink_600_2000/0/1687566624081?e=2147483647&v=beta&t=Upa9XyATDm3WZgwI0Tf4MwpjU26P2C5GkqUbIklVekA

AWS가 제공하는 S3 스토리지 클래스의 종류 및 특징

- standard
    - 가장 일반적인 스토리지 클래스
    - 데이터를 검색할 때 요금 및 최소 사용량에 제한 없이 사용한 만큼 비용을 지불
- intelligent-tiering
    - 객체 접근 정보가 고정되어 있지 않을 때 자동으로 빈번한 접근 그룹과 간혈적 접근 그룹에 나누어서 저장
- infrequent access
    - 객체가 자주 사용되지는 않지만 조회가 필요할 때 사용되는 데이터를 저장하는 클래스
    - 다음과 같이 **2개의 하위 클래스로 분류**
        - **standard-infrequent access**
            - 최소 3개 이상의 가용 영역에 데이터가 저장
            - 내구성이 높은 클래스
        - **one zone-infrequent access**
            - 하나의 가용 영역에만 데이터가 저장
            - 상대적으로 내구성이 낮음
            - 데이터가 삭제되어도 다시 생산할 수 있는 데이터를 위한 클래스
- S3 glacier
    - **데이터 아카이브**와 장기간 백업을 고려하여 만든 스토리지 클래스
        - **아카이빙 데이터?**
            - 오랫동안 데이터가 저장되어 있는 것을 의미
    - 데이터를 다른 클래스로 옮기려면 기가바이트당 비용이 발생하므로 주로 보관 목적으로 사용
- S3 glacier deep archive
    - 재사용이 거의 없는 데이터를 보관할 때 사용하는 클래스
    - 일정 기간이 지나면 삭제할 데이터를 주로 보관
    - 조회하는데 수 시간에서 수 일이 소요될 수 있다.
    - 데이터 보관 비용이 가장 저렴

![Amazon S3 스토리지 클래스 종류][image7]

[image7]: https://blog.kakaocdn.net/dn/K47gd/btr1ucZbKfX/PpCKEcThcWAqn1VPmS2tlK/img.png


### S3 보안

- **일반적인 S3 버킷 접근 방법**
    - 버킷을 생성할 때 사용한 버킷 이름을 포함하여 생성된 유일한 식별자를 기반으로 언제, 어디서든 접근이 가능
    - AWS의 자격 증명 서비스인 IAM(Identity and Access Management)과 밀접하게 연관
        - IAM으로 접속 사용자나 데이터 접근을 관리
    - 특정 S3 버킷 접근에 대해 허용과 거부가 발생한다면 **IAM에서 접근 권한을 통제하기 때문에** 일어나는 상황

S3만의 버킷 정책으로 접근 권한이 있는 사용자가 개별 객체에 접근할 수 있게 권한을 조정

- S3 객체는 기본적으로 외부 사용자가 접근할 수 없도록 설정
    - 객체 소유자와 루트 사용자만 해당 객체에 접근 가능
    - 외부에서 접근하려면 별도의 정책을 이용하여 직접 설정