# Chap07. AWS 고급 네트워킹 서비스
## 7.1 DNS란

이 절에서는 먼저 DNS 개념을 학습한 후 도메인 구조와 DNS 서버들을 살펴보고 DNS 레코드 유형까지 알아보겠다.

### DNS 서비스

- DNS(Domain Name System)
    - 네트워크 통신을 위한 주소 체계를 문자 형태인 도메인으로 매핑하여 연결하는 서비스
    - IP주소를 문자 형태의 도메인 주소로 매핑해서 사용하는 서비스
        - 일반적으로 네트워크 통신 주소는 IP 주소를 사용

![IP주소와 도메인 주소][image1]

[image1]: https://www.tcpschool.com/lectures/img_webbasic_09.jpg

![도메인 주소를 이용한 통신 과정][image2]

[image2]: https://images.velog.io/images/eunnbi/post/ffb27f8b-cc1d-4f24-96f8-ef157eca59d5/image.png

먼저, 웹 서버의 IP 주소를 도메인 주소로 사용하고자 google.com 도메인을 구매하고 등록한다. 그러면 DNS 서버는 google.com 의 IP 주소가 무엇인지 알고 정보를 기록한다.

① - 사용자는 google.com 이라는 도메인 주소가 어떤 IP 주소인지 모르고 있으므로 해당 정보를 확인하는 작업이 필요하다.

②, ③ - 사용자는 도메인 주소의 IP 주소를 확인하기 위해 DNS 서버에 google.com 의 도메인 주소를 요청하고 응답을 받는다. 이때 UDP 53번 포트를 사용하는 DNS 프로토콜을 이용하여 통신한다. 그러면 사용자는 google.com 에 대한 IP 주소가 무엇인지 알 수 있다.

④ - 사용자는 google.com 의 IP 주소를 알아냈기 때문에 해당 IP 주소로 통신한다.


### 도메인 구조

![도메인 구조 예시][image3]

[image3]: https://user-images.githubusercontent.com/13075035/75011772-c3e2d480-54c3-11ea-8e2d-3976d52e3a33.png

**루트 도메인**

- 마지막에 위치하는 온점
    - 우리가 사용하는 모든 도메인 주소의 가장 마지막에는 온점이 있지만, 일반적으로 이 부분은 생략하고 사용

**탑 레벨 도메인(TLD, Top Level Domain)**

- 도메인 주소에서 가장 상위에 위치한 도메인
- ex) .com, .co.kr, .org 등

**세컨드 레벨 도메인(SLD, Second Level Domain)**

- TLD 다음에 위치한 두 번째 도메인 영역
- 상위 TLD에서 유일하게 존재하고 식별하는 도메인 영역
- 일반적으로 도메인 이름은 SLD와 TLD를 합친 형태로 표현

**서브 도메인**

- 도메인을 용도에 따라 앞에 명칭을 부여해서 분류하는 영역



### DNS 서버 종류

도메인 구조를 분류하는 가장 큰 이유는 영역별 도메인을 관리하는 주체를 분리하기 위해서다.

**도메인은 DNS 네임 서버로 관리**하는데, 이때 도메인 영역별로 DNS 네임 서버를 분류해서 관리한다.

**루트 네임 서버**

- 루트 도메인을 관리하는 DNS 서버
- DNS 요청에 대해 TLD에 해당하는 네임 서버 정보를 응답
- 루트 네임 서버는 전 세계에 13개만 존재

**TLD 네임 서버**

- 도메인 이름의 최상위 영역인 TLD를 관리하는 DNS 서버
- TLD 영역에서 식별되는 모든 SLD를 관리하여 DNS 요청에 대해 SLD 네임 서버 정보를 응답
    - 해당 도메인에 대한 DNS 요청이 있으면 SLD 네임 서버 주소를 알려줌

**SLD 네임 서버**

- 실직적인 도메인 이름을 관리하는 DNS 서버
- 실제 도메인의 최종 관리 서버로 ‘권한이 있는 네임 서버’라고 부름
- 도메인 주소에 대한 IP 주소를 확인하는 가장 마지막 단계

**DNS 해석기**

- 사용자와 네임 서버 사이에서 중계자 역할을 수행하는 목적
- DNS 해석기를 이용하여 단계별로 DNS 요청과 응답을 수행하여 도메인 주소의 최종 IP 주소를 확인


### DNS 통신 흐름

![DNS 서버 통신 흐름][image4]

[image4]: https://velog.velcdn.com/images/qltkd5959/post/e648b60a-34af-4aa8-bcbf-d627007743dd/image.png

① - 사용자 PC에서 www.example.com 이라는 도메인 주소의 IP 주소를 알기 위해 DNS 서버에 질의한다. 여기에서 DNS 서버는 DNS 해석기를 이용하여 다양한 네임 서버와 통신하는 중계자 역할을 수행한다.

② - 기본적으로 DNS 해석기는 전 세계에 있는 루트 네임 서버의 주소를 알고 있다. 해당 루트 네임 서버에 www.example.com 도메인 주소의 IP 주소를 물어본다. 여기에서 루트 네임 서버는 www.example.com 이라는 도메인 주소를 알지 못하지만 .com의 TLD 네임 서버는 알고 있기 때문에 해당 정보를 DNS 해석기에 전달한다.

③ - 그러면 DNS 해석기는 .com에 해당하는 TLD 네임 서버에 www.example.com 도메인 주소의 IP 주소를 물어본다. 여기에서 TLD 네임 서버는 www.example.com 이라는 도메인 주소를 알지 못하지만 example.com 의 SLD 네임 서버는 알고 있어 해당 정보로 DNS 해석기에 전달한다.

④ - 다시 DNS 해석기는 example.com 에 해당하는 SLD 네임 서버에 www.example.com 도메인 주소의 IP 주소를 물어본다. 이 SLD 네임 서버는 도메인 주소의 최종 정보가 있는 ‘권한이 있는 네임 서버’로, www.example.com 에 대한 IP 주소를 DNS 해석기에 전달한다.

⑤ - DNS 해석기는 www.example.com 에 대해 최종적으로 해석한 IP 주소를 사용자 PC에 전달한다. 이것으로 사용자 PC는 www.example.com 도메인 주소의 IP 주소를 알게 되어 해당 IP 주소로 통신한다.



### DNS 레코드 유형

DNS 레코드는 도메인에 대한 요청 처리 방법을 정의한 것으로, 용도에 따라 DNS 레코드 유형을 분류

**A 레코드 유형**

- 도메인 이름을 IPv4 주소로 매핑하는 가장 기본적인 DNS 레코드 유형

**AAAA 레코드 유형**

- 도메인 이름을 IPv6 주소로 매핑하는 DNS 레코드 유형

**NS 레코드 유형**

- 도메인 이름의 네임 서버 주소로 매핑하는 DNS 레코드 유형

**CNAME 레코드 유형**

- 도메인 이름의 별칭을 지정하는 DNS 레코드 유형으로, 다른 도메인 이름을 정의

![DNS 레코드 유형][image5]

[image5]: https://blog.kakaocdn.net/dn/S2YvF/btq27oKOT6H/7bBarmkCnCWdqbOiPSMGYk/img.png


> ✅ **A 레코드 유형** - 도메인을 IPv4 주소로 매핑하는 유형  
**AAAA 레코드 유형** - 도메인을 IPv6 주소로 매핑하는 유형  
**NS 레코드 유형** - 도메인의 네임 서버 주소를 매핑하는 유형  
**CNAME 레코드 유형** - 도메인 별칭을 지정



## 7.2 Amazon Route 53 서비스

**Amazon Route 53** 서비스는 AWS에서 제공하는 관리형 DNS 서비스

### Amazon Route 53의 주요 기능

Amazon Route 53은 다음 그림과 같은 형태의 아이콘으로 표현

DNS 프로토콜은 UDP 53번 포트를 사용

![Amazon Route 53][image6]

[image6]: https://devio2023-media.developers.io/wp-content/uploads/2022/08/amazon-route-53-960x504.png

Amazon Route 53은 주로 **도메인 이름 등록**과 **호스팅 영역 생성**, **레코드 작성** 같은 기능을 제공

**도메인 이름 등록**

- 도메인 이름을 사용하려면 도메인 이름을 등록하는 절차가 필요
- 전 세계에 위치한 네임 서버에 도메인 이름을 사용한다고 알려야 하는데, 이 작업은 개인이 아닌 등록대행소에서 관장
    - 사용자가 도메인 등록대행소에 도메인 이름 등록을 요청하면 도메인 등록 작업을 대행
- 도메인 등록대행소로 국내외에 다양한 웹 사이트가 존재
    - Amazon Route 53도 도메인 등록대행소 역할을 수행
- 도메인 영역별 네임 서버를 관리하고 등록을 관장하는 단체들
    
    ICANN - 비영리 단체가 루트 네임 서버를 관리하고 TLD 네임 서버를 등록하는 역할을 수행
    
    ‘등록소’ - 라고 하는 기관이나 기업들이 TLD 네임 서버를 관리하고 권한 있는 네임 서버를 등록하는 역할을 수행
    

**호스팅 영역 생성**

- Amazon Route 53으로 호스팅 영역을 생성하여 네임 서버 관리 가능
- 호스팅 영역을 생성해야 Amazon Route 53이 등록된 도메인 이름에 대한 권한 있는 네임 서버이자 SLD 네임 서버의 역할을 수행 가능
- 호스팅 영역의 네임 서버들은 고가용성을 위해 다수의 서버로 구성
    - 네임 서버들의 Zone을 구성하는 개념

**레코드 작성**

- Amazon Route 53은 DNS 레코드를 정의하여 도메인에 대한 요청 처리 방법을 정의 가능
    - 이런 DNS 레코드는 다양한 형태의 라우팅 정책을 연결하여 도메인 요청에 대한 응답 방식을 정의 가능
- Amazon Route 53은 DNS 요청에 어떻게 응답할지 정의하는 다양한 라우팅 정책이 존재


### Amazon Route 53의 라우팅 정책

![단순, 가중치, 지연 시간 기반 라우팅][image7]

[image7]: https://devio2023-media.developers.io/wp-content/uploads/2021/11/Route_53_Console_Hosted_Zones-8-960x633.png

**단순 라우팅 정책**

- 도메인에 대해 특정 대상을 지정하는 방식
- 여러 대상이 있으면 랜덤한 대상을 선택하고 응답

**가중치 기반 라우팅 정책**

- 대상의 가중치를 지정하여 비중에 따라 대상을 선택하고 응답
- 가중치는 0~255 범위에서 설정
- 대상별 가중치 값을 합산한 전체 가중치를 대상별 가중치로 나누어 비중을 부여

**지연 시간 기반 라우팅 정책**

- 다수의 리전에 대상 자원이 있으면 사용자와 인접한 리전을 기준으로 대상 자원의 리전까지 지연 시간을 파악해서 낮은 지연 시간의 대상을 선택하고 응답

**장애 조치 라우팅 정책**

- 다수의 대상 자원에 대해 액티브와 패시브로 분류하고 대상 상태를 주기적으로 검사하여 액티브 대상을 선택하고 응답
- 액티브 대상이 통신 불가능할 때는 패시브 대상을 액티브로 승격하여 대상 경로로 라우팅

**지리 위치 라우팅 정책**

- 사용자 PC가 지정하는 DNS 서버의 지리적으로 인접한 리전에 위치한 대상으로 경로를 선택하는 정책

**지리 근접 라우팅 정책**

- 지리 위치 라우팅과 형태가 동일하지만 영향도를 조정하는 바이어스(bias)라는 값을 사용하여 제어하는 정책

**다중 값 응답 라우팅 정책**

- DNS 요청에 대해 다수의 값을 반환할 수 있는 정책

> ✅ **Amazon Route 53 라우팅 정책** - DNS 요청에 대해 어떻게 응답할지 정의하는 정책  
**단순 라우팅 정책** - 도메인에 대해 특정 대상을 지정하고 랜덤하게 대상 선택  
**가중치 기반 라우팅 정책** - 도메인에 대해 특정 대상을 지정하고 가중치에 따라 대상 선택  
**지연 시간 기반 라우팅 정책** - 사용자 인접 리전을 기준으로 대상 자원의 리전 간 지연 시간을 파악하여 대상 선택  
**장애 조치 라우팅 정책** - 다수의 대상을 액티브와 패시브로 분류하고 액티브 대상을 선택하여, 주기적인 상태를 확인하여 액티브 대상 유지


### 도메인 이름 생성하기

도메인 등록대행소를 통해 도메인 이름을 등록해서 생성 가능

**도메인 이름을 등록하는 두 가지 방법**

1. 무료 도메인 이름 생성 사이트 활용
- [freenom 웹 사이트](http://bit.ly/cnba0502)를 활용하면 무료로 도메인 이름을 생성 가능
    - 하지만 현재 해당 웹 사이트의 기술적 이슈로 신규 도메인 생성이 중지된 상태

> 💡 해당 웹 사이트에서도 무료로 도메인 이름을 생성할 수 있지만, 생성한 도메인의 네임 서버 역할로 Amazon Route 53 호스팅 영역에서 관리하면 월 $0.5 과금이 발생


2. Amazon Route 53을 사용한 유료 도메인 이름 생성
- Amazon Route 53을 등록대행소로 하여 유료 도메인 이름을 생성 가능
    - Amazon Route 53에서 가장 저렴한 TLD는 click이라는 TLD로 1년 사용로가 $3



## 7.3 CDN이란

**CDN(Contents Delivery Network)**

- 콘텐츠 제공자와 사용자가 지리적으로 멀리 떨어져 있는 환경에서 콘텐츠를 빠르게 전달하는 네트워크 기술
- CDN 기술 핵심은 캐시 서버를 지역적으로 분산하고 콘텐츠를 동기화하여 분산 처리하는 것

### CDN 환경

**CDN 기술이 없는 일반적인 네트워크 통신 환경**

- 원본 콘텐츠를 가지고 있는 오리진(origin) 서버에서 사용자에게 콘텐츠를 전달
- 이런 환경에서는 오리진 서버에 높은 부하가 발생
- 지리적으로 멀리 떨어져 있는 사용자에게 콘텐츠를 전달할 때 지연 시간이 길어짐
    - 콘텐츠를 효율적이고 원할하게 제공하는 데 어려움이 존재

![CDN 기술이 없는 일반 네트워크 환경][image8]

[image8]: https://blog.kakaocdn.net/dn/dMHvlk/btrW2tdpqcG/HRQq6hjiY02uebXbcowItk/img.png

**CDN 기술을 이용한 네트워크 통신 환경**

- 오리진 서버에서 지역적으로 분산된 캐시 서버에 콘텐츠를 동기화해서 콘텐츠가 분산된 환경을 구성
- 사용자는 인접한 캐시 서버로 콘텐츠를 전달 받아 빠르고 효율적인 서비스를 제공 받음
- 높은 성능과 가용성을 보장

![CDN 기술을 이용한 네트워크 환경][image9]

[image9]: https://glowhost.com/images/cdn.jpg


### CDN 캐싱 방식

**캐싱**

- 오리진 서버의 원본 콘텐츠를 지역적으로 분산된 캐시 서버로 전달하고 콘텐츠를 저장하는 것

**캐시 미스(Cache Miss)**

- 캐시 서버에 콘텐츠를 가지고 있지 않은 캐싱 상태

**Cache Miss 상황**

① - 사용자가 캐시 서버에 콘텐츠를 요청

② - 캐시 서버에 해당 콘텐츠가 없어 Cache Miss 판정

③ - 캐시 서버는 오리진 서버에 콘텐츠를 요청

④ - 오리진 서버는 원본 콘텐츠를 복제하여 캐시 서버에 전달

⑤ - 캐시 서버는 해당 콘텐츠를 저장하는 캐싱을 수행

⑥ - 캐시 서버는 사용자에게 콘텐츠를 전달

> 💡 여기에서 캐시 서버는 콘텐츠를 저장하는 캐싱을 수행할 때, 유연하게 관리하고자 일정 시간 동안 콘텐츠를 유지하고 삭제하는 동작을 취한다. 이렇게 콘텐츠를 캐싱하는 시간을 **TTL(Time To Live)** 이라고 한다.


> 💡 ⑤는 정적 캐싱에 해당하는 동작이다. 동적 캐싱은 콘텐츠를 저장하지 않고 통과시킨다.


**캐시 히트(Cache Hit)**

- 캐시 서버에 콘텐츠를 가지고 있는 캐싱 상태

**Cache Hit 상황**

① - 사용자가 캐시 서버에 콘텐츠를 요청

② - 캐시 서버에서 해당 콘텐츠를 가지고 있어 Cache Hit 판정

③ - 캐시 서버는 사용자에게 콘텐츠를 전달

![Cache Hit와 Cache Miss 상태에 따른 동작][image10]

[image10]: https://velog.velcdn.com/images/boo105/post/9b3d5058-5d0d-4729-a3aa-e3df29176f2b/image.png


### 두 가지 형태의 캐싱 방식

**정적 캐싱**

- 정적 콘텐츠를 캐싱하는 방식
- 정적 콘텐츠가 변경되지 않는 특징에 따라 별도의 사용자 요청이 없어도 오리진 서버에서 캐시 서버로 미리 콘텐츠를 복사
    - 사용자가 캐시 서버로 콘텐츠를 요청하면 TTL 동안 바로 응답할 수 있는 Cache Hit 상태로 동작하는 이유
- CDN 캐싱의 이점을 살려 효율적으로 전송 가능

> 💡 **정적 콘텐츠** - 변경되거나 수정되지 않는 콘텐츠를 의미  
▶ 일반적으로 이미지 파일, 자바스크립트, CSS 등이 해당  
▶ 웹 사이트의 레이아웃을 구성하는 콘텐츠 대부분이 정적 콘텐츠

**동적 캐싱**

- 사용자 요청이나 정보에 따라 즉석에서 생성되는 콘텐츠를 의미
    - 사용자 정보를 활용하여 매번 변경되는 형태의 콘텐츠
- 동적 콘텐츠를 캐싱하는 방식을 의미
- 동적 콘텐츠가 요청할 때마다 변경이 되는 특징이 있어 캐시 서버에서 콘텐츠를 보관하지 않고 Cache Miss 상태로 동작
    - 캐시 서버는 컨텐츠를 저장하지 않고 통과시키기 때문에 결국 사용자는 오리진 서버에서 캐시 서버를 거쳐 콘텐츠를 전달 받음
- 캐시 서버에서 동적 콘텐츠를 저장하지 않기 때문에 TTL을 0으로 설정
- CDN 캐싱의 이점을 살리기 어려움

> ✅ **캐싱** - 캐시 서버에서 콘텐츠를 저장하는 행위  
**Cache Miss** - 캐시 서버에 콘텐츠를 가지고 있지 않은 상태  
**Cache Hit** - 캐시 서버에 콘텐츠를 가지고 있는 상태  
**정적 콘텐츠** - 변경되거나 수정되지 않는 콘텐츠  
**동적 콘텐츠** - 사용자 요청에 따라 변경되는 콘텐츠  
**정적 캐싱** - 정적 콘텐츠에 대한 캐싱으로 TTL 동안 미리 콘텐츠를 저장해 두고 Cache Hit 상태로 동작  
**동적 캐싱** - 동적 콘텐츠에 대한 캐싱으로 캐시 서버는 콘텐츠를 저장하지 않고 지속적인 Cache Miss 상태로 동작


## 7.4 Amazon CloudFront란

- AWS에서 제공하는 CDN 서비스
- 정적 콘텐츠나 동적 콘텐츠를 사용자에게 빠르게 배포하도록 지원하는 서비스
- 전 세계에 분포된 엣지 로케이션(edge location)이라는 곳에 콘텐츠를 캐싱하고 사용자 요청에 따라 가장 지연 시간이 낮은 엣지 로케이션이 응답하여 최적의 성능을 보장

![Amazon CloudFront의 엣지 로케이션][image11]

[image11]: https://dev.classmethod.jp/wp-content/uploads/2013/08/Paying.gif

### Amazon CloudFront 구성

- AWS의 글로벌 엣지 네트워크를 이용하여 오리진 대상의 콘텐츠를 전 세계에 위치한 엣지 로케이션과 리전 엣지 캐시에 캐싱하여 CDN 서비스를 제공

[Amazon CloudFront 지역별 위치 & 주요 기능](https://aws.amazon.com/ko/cloudfront/features/)

#### Amazon CloudFront 구성 요소

**오리진** - 원본 콘텐츠를 가지고 있는 대상이다. 이 대상은 온프레미스의 일반 서버나 AWS 서비스의 EC2, ELB, S3가 될 수 있다.

**Distribution** - 오리진과 엣지 중간에서 콘텐츠를 배포하는 역할을 수행하는 CloudFront의 독립적인 단위이다. 웹 서비스 전용의 Web Distribution과 스트리밍 전용의 RTMP Distribution으로 분류된다.

**리전 엣지 캐시** - 빈번하게 사용되는 콘텐츠에 대해 캐싱하는 큰 단위의 엣지 영역이다. 오리진과 엣지 로케이션 사이에 위치한다. 엣지 로케이션에서 오리진으로 콘텐츠를 요청하는 상황을 줄여 효율적으로 CDN 서비스를 제공한다.

**엣지 로케이션** - Distribution으로 배포되는 콘텐츠를 캐싱하는 작은 단위의 엣지 영역이다. 사용자 입장에서 가장 인접한 엣지 로케이션이 콘텐츠를 전달한다.

### Amazon CloudFront 기능

Amazon CloudFront는 **다양한 기능**을 이용하여 효율적인 CDN 서비스를 제공

**정적 및 동적 콘텐츠 처리**

- Amazon CloudFront는 정적 콘텐츠와 동적 콘텐츠에 최적화된 캐싱 동작을 제공

**HTTPS 기능**

- 오리진 대상이 HTTPS를 지원하지 않아도 Amazon CloudFront가 알아서 HTTPS 통신을 중계
    - 사용자와 CloudFront는 HTTPS로 통신 가능
    - CloudFront와 오리진은 HTTP로 통신 가능

**다수의 오리진 선택 기능**

- Amazon CloudFront의 단일 Distribution 환경에서 다수의 오리진을 지정하고 선택하여 콘텐츠 분산 처리 가능

**접근 제어**

- 서명된 URL과 쿠키(cookie)로 사용자 인증을 지원하여 인증된 사용자만 접근 가능하도록 지원