# Chap09. AWS 오토 스케일링 서비스
## 9.1 스케일링

### 스케일링이란

- 스케일링(scaling)
    - IT 측면에서는 IT 자원을 확장하거나 축소하는 기능을 의미

IT 자원의 사용 요구는 항상 고정적이지 않고 특정 상황이나 이벤트에 따라서 가변적이다.
IT 자원의 사용 요구가 가변적일수록 자원의 성능 및 수량을 확장하거나 축소하는 개념인 스케일링은 필수다.

**_상황 예시_**  
인터넷 쇼핑몰 운영 중 특정 기간에 할인 정책이 시행된다고 가정
- 사용자가 폭증하면 현재 IT 자원만으로는 서비스를 유지하기가 어려움
    - 이때 스케일링으로 IT 자원의 용량이나 수량을 확장하여 서비스를 수용하도록 조정
- 쇼핑몰 할인 정책이 종료되어 평상시로 돌아왔다면 앞서 확장한 IT 자원으로 서비스를 유지하는 것은 낭비
    - 이때 스케일링 기능으로 IT 자원의 용량이나 수량을 축소하면 낭비 없이 적절한 서비스가 가능

스케일링으로 IT 자원의 고가용성과 내결함성을 확보할 수 있다.


### 스케일링의 종류

스케일링 기법은 확장 및 축소 방향에 따라 **수직 스케일링(vertical scaling)** 과 **수평 스케일링(horizontal scaling)** 으로 구분된다. 수직 스케일링은 상하로 변화하는 것이고, 수평 스케일링은 좌우로 변화하는 것을 의미한다.

**수직 스케일링**

- IT 자원의 용량을 확장하거나 축소하는 것
- 스케일 업(scale-up)과 스케일 다운(scale-down)으로 분류
    
    **스케일 업**
    
    - IT 자원에 부하가 증가하면 CPU나 메모리 등을 성능이 높은 것으로 대체하는 것
    
    **스케일 다운**
    
    - IT 자원에 부하가 감소하면 CPU나 메모리 등을 성능이 낮은 것으로 대체하는 것
- 수직 스케일링은 부하 상태에 따라 IT 자원 자체 성능을 조정하는 것으로 정의

**수평 스케일링**

- IT 자원의 수량을 확장하거나 축소하는 것
- 스케일 인(scale-in)과 스케일 아웃(scale-out)으로 분류
    
    **스케일 아웃**
    
    - IT 자원에 부하가 증가하면 자원 수량을 늘리는 것
    
    **스케일 인**
    
    - IT 자원에 부하가 감소하면 자원 수량을 줄이는 것
- 수평 스케일링은 부하 상태에 따라 IT 자원의 수량을 조정하는 것으로 정의

![수직 스케일링과 수평 스케일링][image1]

[image1]: https://blog.kakaocdn.net/dn/Vjqsk/btr8kdw985y/KabI5iigIiUML2iKJW0s60/img.png

> ✅ **스케일링(scaling)**: IT 자원을 확장하거나 축소하는 기능  
**수직 스케일링(vertical scaling)**: IT 자원의 용량을 확장하거나 축소하는 기능  
    **- 스케일 업(scale-up)**: IT 자원에 부하가 증가하면 자원 용량 확장  
    **- 스케일 다운(scale-down)**: IT 자원에 부하가 감소하면 자원 용량 축소  
**수평 스케일링(horizontal scaling)**: IT 자원의 수량을 확장하거나 축소하는 기능  
    **- 스케일 아웃(sclae-out)**: IT 자원에 부하가 증가하면 자원 수량 확장  
    **-** **스케일 인(scale-in)**: IT 자원에 부하가 감소하면 자원 수량 축소

## 9.2 AWS 오토 스케일링 서비스

**AWS 오토 스케일링**

- AWS가 제공하는 클라우드 자원에 대한 스케일링 서비스
- 스케일링으로 클라우드 자원을 ‘동적으로’ 확장하거나 축소하여 클라우드 자원의 규모를 조정
- 동적으로 스케일링을 수행한다는 것은 클라우드 환경과 밀접한 관계가 존재
- AWS는 클라우드 온디맨드 특성으로 요구가 있을 때 즉시 자원을 할당한다는 측면에서 동적인 스케일링 작업을 수행 가능

**AWS 오토 스케일링 기능으로 클라우드 자원 규모를 조정하는 대상**

- Amazon EC2 인스턴스
- Amazon ECS
- Amazon DynamoDB의 테이블 및 인덱스
- Amazon Aurora의 복제본 등

### Amazon EC2 오토 스케일링이란

**Amazon EC2 오토 스케일링**

- EC2 인스턴스에 설치된 애플리케이션 워크로드를 수용하도록 동적으로 EC2 인스턴스 수를 확장하거나 축소하여 워크로드를 유지하는 서비스
- EC2 인스턴스에 대해 수평 스케일링으로 스케일 아웃과 스케일 인을 동적으로 수행하는 개념

기본적으로 오토 스케일링 그룹이라는 EC2 인스턴스 모음을 생성한다.
최소 및 최대 인스턴스 수를 지정하여 그룹 내 해당 범위로 인스턴스 수를 유지
한다.
스케일링 조정 정책(scaling policy)에 따라 설정한 기준으로 인스턴스를 시작하거나 종료한다.

![Amazon EC2 오토 스케일링 그룹 예시][image2]

[image2]: https://velog.velcdn.com/images/repush/post/2a27c2ba-6385-4f4a-baaf-33192dacf118/image.png

#### 오토 스케일링 그룹 정보(위의 이미지 예시)
- 최소 크기: 1
- 최대 크기: 4
- 최초 요구 용량: 2

> ✅ **AWS EC2 오토 스케일링**: 동적으로 변하는 애플리케이션 워크로드를 수용하려고 동적으로 EC2 인스턴스 수를 확장하거나 축소하여 안정적으로 서비스를 유지하는 기능

### AWS EC2 오토 스케일링 구성 요소

Amazon EC2 오토 스케일링 서비스의 핵심 구성 요소는 **그룹, 구성 템플릿, 조정 옵션**으로 구분된다.

**그룹**

- EC2 인스턴스를 오토 스케일링으로 저장하고 관리하기 위해 EC2 인스턴스를 논리적으로 구분하는 그룹으로 구성
- 그룹을 생성할 때 EC2 인스턴스의 최소 및 최대 인스턴스 수와 최초 요구하는 인스턴스 수 등 정보를 지정 가능

**구성 템플릿**

- EC2 인스턴스를 구성하는 템플릿으로 인스턴스 AMI, 인스턴스 유형, 키 페어, 보안 그룹 등 정보를 지정 가능

**조정 옵션**

- 오토 스케일링 그룹을 조정하는 다양한 방법을 정의하는 것
- 지정한 조건이나 일정에 따라 오토 스케일링 그룹을 조정 가능

![Amazon EC2 오토 스케일링 구성 요소][image3]

[image3]: https://velog.velcdn.com/images/repush/post/c9ef63c4-4f60-41cc-b816-46605dc2eb44/image.png


### Amazon EC2 오토 스케일링의 인스턴스 수명 주기

Amazon EC2 오토 스케일링은 일반적인 EC2 인스턴스와는 다른 수명 주기(life cycle)가 있다.
이런 수명 주기는 Amazon EC2 오토 스케일링이 인스턴스를 시작하고 서비스에 들어갈 때 시작되며, 인스턴스를 종료할 때는 서비스에서 제외하고 대상을 종료한다.

![Amazon EC2 오토 스케일링 인스턴스 수명 주기][image4]

[image4]: https://blog.kakaocdn.net/dn/nC19e/btrtDE274cy/t4Vj5xP1gjvoDls1jkbcY1/img.png

위의 이미지와 같이 다양한 이벤트로 인스턴스의 상태가 전환된다.

**① 인스턴스 확장에 따른 이벤트**

**Amazon EC2 오토 스케일링 에서 인스턴스 확장에 따른 이벤트가 발생하는 경우**

1. 오토 스케일링 그룹의 크기를 수도으로 늘리는 경우
2. 지정된 수요 증가에 따라 오토 스케일링 그룹의 크기를 자동으로 늘리는 조정 정책을 적용하는 경우
3. 특정 시간에 오토 스케일링 그룹의 크기를 자동으로 늘리는 예약된 작업을 수행하는 경우

**② 인스턴스 축소에 따른 이벤트**

**Amazon EC2 오토 스케일링에서 인스턴스를 축소하는 이벤트가 발생하는 경우**

1. 오토 스케일링 그룹의 크기를 수동으로 줄이는 경우
2. 지정된 수요 감소에 따라 오토 스케일링 그룹의 크기를 자동으로 줄이는 조정 정책을 적용하는 경우
3. 특정 시간에 오토 스케일링 그룹의 크기를 자동으로 줄이는 예약된 작업을 수행하는 경우

이렇게 인스턴스 확장 이벤트나 인스턴스 축소 이벤트에 따라 오토 스케일링이 동작하여 인스턴스 자원의 수요와 서비스 중인 인스턴스 자원을 최대한 일치시킬 수 있다.

> ✅ Amazon EC2 오토 스케일링은 이벤트에 따른 수명 주기가 동작하여 인스턴스 상태를 전환한다. 이 중 인스턴스 확장에 따른 이벤트나 인스턴스 축소에 따른 이벤트로 인스턴스를 실행하거나 종료하여 자원의 수요를 최대한 일치시킬 수 있다.


### Amazon EC2 오토 스케일링 조정 옵션

Amazon EC2 오토 스케일링 조정 옵션은 오토 스케일링 그룹을 조정하는 다양한 방법을 제공한다.

**인스턴스를 일정한 수로 유지**

- 오토 스케일링 조정 옵션으로 오토 스케일링 그룹의 인스턴스를 지정된 수로 유지 가능
- 실행 중인 인스턴스를 주기적으로 확인하여 비정상 상태의 인스턴스가 있으면 해당 인스턴스를 종료하고 새로운 인스턴스를 시작해서 일정한 수로 유지

**수동 조정**

- 오토 스케일링의 가장 기본적인 방법
- 오토 스케일링 그룹의 최대/최소 용량을 수동으로 변경 가능
- 수동 조정으로 업데이트된 사항으로 인스턴스를 생성하거나 종료

**동적 조정**

- 트래픽 변화에 따라 오토 스케일링 그룹의 용량을 조정

동적 조정은 다음과 같은 동적 조정 정책을 지원한다.

**대상 추적 조정**

- 대상 인스턴스를 추적해서 특정 지표의 목표 값을 기준으로 유지하기 위해 오토 스케일링 적용
- 예시로, 평균 CPU 사용률 50%를 목표로 하는 지표 값으로 대상 추적 조정 정책을 생성하면, 인스턴스 수를 조정하여 지표 값에 맞게 유지

**단계 조정**

- 오토 스케일링 그룹의 용량을 단계별로 조정하여 오토 스케일링 적용
- 즉, 임곗값 기준으로 임곗값을 넘어서는 크기에 따라 단계적으로 조정

**단순 조정**

- 오토 스케일링 그룹의 용량을 단일하게 조정하여 오토 스케일링 적용
- 즉, 임곗값 기준으로 임곗값을 넘어서는 크기와 무관하게 단일하게 조정

**일정을 기반으로 예약된 조정**

- 작업 시간이나 날짜에 따라 오토 스케일링을 수행하는 것
- 그룹의 인스턴스 수를 늘려야 할지 또는 줄여야 할지 정확히 아는 경우에 유용
- 예시로, 업무 시간에는 사용량이 많고 업무 시간 이후에는 사용량이 줄어드는 것처럼 반복되는 일정에서는 업무가 시작되면 예약된 조정을 바탕으로 미리 용량 추가 가능

**일정을 기반으로 예측 조정**

- 지난 측정 값으로 누적된 기록을 이용하여 트래픽 흐름의 일일 및 주간 패턴을 예측해서 오토 스케일링 그룹의 인스턴스 수를 늘리거나 줄이는 것

Amazon EC2 오토 스케일링은 다양한 조정 옵션을 제공하기 때문에 자원의 어플리케이션이 가진 특징을 충분히 이해하고 적합한 조정 기능을 선택하는 것이 중요하다.

### Amazon EC2 오토 스케일링 요금

Amazon EC2 오토 스케일링을 사용할 때 별도로 발생하는 요금은 없다. 단지 사용한 EC2 인스턴스와 CloudWatch 정보에 따른 요금만 발생한다. 프리 티어 정책으로 EC2 인스턴스와 CloudWatch를 일정 수준까지 무료로 사용할 수 있다.